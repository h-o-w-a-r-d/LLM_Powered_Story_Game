
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval'">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 動態文字冒險遊戲</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <!-- 遮罩層 -->
    <div id="overlay" class="overlay active"></div>
    
    <div id="app">
        <!-- 使用說明面板 -->
        <div id="help-panel" class="panel modal-panel hidden">
            <h2><i class="fas fa-question-circle"></i> <span data-lang-key="ui.helpTitle">使用說明</span></h2>
            
            <div class="help-content">
                <div class="help-section">
                    <h3><i class="fas fa-rocket"></i> <span data-lang-key="help.quickStart">🚀 快速上手</span></h3>
                    <div class="help-steps">
                        <div class="help-step">
                            <span class="step-number">1</span>
                            <div class="step-content">
                                <h4 data-lang-key="help.step1.title">設定 API 金鑰</h4>
                                <p data-lang-key="help.step1.desc">點擊右側 ⚙️ 設定按鈕，前往 <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a> 免費申請 Gemini API 金鑰，然後貼上並儲存。</p>
                            </div>
                        </div>
                        <div class="help-step">
                            <span class="step-number">2</span>
                            <div class="step-content">
                                <h4 data-lang-key="help.step2.title">創建你的角色</h4>
                                <p data-lang-key="help.step2.desc">選擇喜歡的世界觀，詳細描述你想扮演的角色，分配 175 點屬性點數（或開啟作弊模式獲得無限點數）。</p>
                            </div>
                        </div>
                        <div class="help-step">
                            <span class="step-number">3</span>
                            <div class="step-content">
                                <h4 data-lang-key="help.step3.title">開始冒險</h4>
                                <p data-lang-key="help.step3.desc">點擊「開始新冒險」，AI 將為你生成專屬的開場故事和初始狀態。</p>
                            </div>
                        </div>
                        <div class="help-step">
                            <span class="step-number">4</span>
                            <div class="step-content">
                                <h4 data-lang-key="help.step4.title">享受遊戲</h4>
                                <p data-lang-key="help.step4.desc">點擊行動選項推動劇情，或使用自訂行動輸入任何想執行的動作。隨時可查看角色狀態、存檔或重新生成回答。</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3><i class="fas fa-star"></i> <span data-lang-key="help.features">✨ 特色功能</span></h3>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <i class="fas fa-palette"></i>
                            <h4 data-lang-key="help.feature1.title">10 種精美主題</h4>
                            <p data-lang-key="help.feature1.desc">深色、賽博龐克、奇幻、蒸汽龐克等多種視覺風格任你選擇</p>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-infinity"></i>
                            <h4 data-lang-key="help.feature2.title">無限制使用</h4>
                            <p data-lang-key="help.feature2.desc">想玩多久就玩多久，沒有次數限制，只消耗你自己的 API 額度</p>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-globe"></i>
                            <h4 data-lang-key="help.feature3.title">17 種世界觀</h4>
                            <p data-lang-key="help.feature3.desc">奇幻、科幻、武俠、仙俠等豐富世界，每種都有獨特的狀態系統</p>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-code"></i>
                            <h4 data-lang-key="help.feature4.title">支援多種 AI</h4>
                            <p data-lang-key="help.feature4.desc">支援 OpenAI、Claude、Gemini 等所有相容 API，自由選擇最強模型</p>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-download"></i>
                            <h4 data-lang-key="help.feature5.title">本地化部署</h4>
                            <p data-lang-key="help.feature5.desc">可下載到本地運行，完全掌控你的資料和隱私</p>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-heart"></i>
                            <h4 data-lang-key="help.feature6.title">完全免費</h4>
                            <p data-lang-key="help.feature6.desc">所有功能完全免費開放，無需註冊，無隱藏費用</p>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3><i class="fas fa-gamepad"></i> <span data-lang-key="help.gameplay">🎮 遊戲玩法</span></h3>
                    <div class="gameplay-tips">
                        <div class="tip-item">
                            <i class="fas fa-lightbulb"></i>
                            <div>
                                <h4 data-lang-key="help.tip1.title">角色描述技巧</h4>
                                <p data-lang-key="help.tip1.desc">描述越詳細，AI 生成的故事越貼合你的想像。包含背景、性格、目標等資訊效果更佳。</p>
                            </div>
                        </div>
                        <div class="tip-item">
                            <i class="fas fa-redo"></i>
                            <div>
                                <h4 data-lang-key="help.tip2.title">重新生成功能</h4>
                                <p data-lang-key="help.tip2.desc">不滿意 AI 的回應？點擊「重新生成回答」按鈕，AI 會給出不同的故事發展。</p>
                            </div>
                        </div>
                        <div class="tip-item">
                            <i class="fas fa-keyboard"></i>
                            <div>
                                <h4 data-lang-key="help.tip3.title">自訂行動</h4>
                                <p data-lang-key="help.tip3.desc">不侷限於預設選項！輸入任何你想執行的動作，AI 會即時回應生成劇情。</p>
                            </div>
                        </div>
                        <div class="tip-item">
                            <i class="fas fa-save"></i>
                            <div>
                                <h4 data-lang-key="help.tip4.title">存檔系統</h4>
                                <p data-lang-key="help.tip4.desc">支援瀏覽器存檔和文件下載兩種方式，隨時保存你的冒險進度。</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3><i class="fas fa-question"></i> <span data-lang-key="help.faq">❓ 常見問題</span></h3>
                    <div class="faq-list">
                        <div class="faq-item">
                            <h4 data-lang-key="help.faq1.q">Q: API 金鑰需要付費嗎？</h4>
                            <p data-lang-key="help.faq1.a">A: Google AI Studio 提供免費額度，一般使用完全足夠。只有大量使用才需要付費。</p>
                        </div>
                        <div class="faq-item">
                            <h4 data-lang-key="help.faq2.q">Q: 我的 API 金鑰安全嗎？</h4>
                            <p data-lang-key="help.faq2.a">A: 金鑰只存在你的瀏覽器本地，不會上傳到我們的服務器，完全安全。</p>
                        </div>
                        <div class="faq-item">
                            <h4 data-lang-key="help.faq3.q">Q: 可以離線使用嗎？</h4>
                            <p data-lang-key="help.faq3.a">A: 可以下載到本地運行，但呼叫 AI 時仍需要網路連線。</p>
                        </div>
                        <div class="faq-item">
                            <h4 data-lang-key="help.faq4.q">Q: 支援哪些 AI 模型？</h4>
                            <p data-lang-key="help.faq4.a">A: 支援所有 OpenAI 格式的 API，包含 GPT-4、Claude、Gemini 等主流模型。</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel-actions">
                <button id="close-help-btn" class="btn-primary"><i class="fas fa-check"></i> <span data-lang-key="ui.gotIt">我知道了</span></button>
            </div>
        </div>

        <!-- 設定面板 -->
        <div id="settings-panel" class="panel modal-panel hidden">
            <h2><i class="fas fa-cog"></i> <span data-lang-key="ui.settings">設定</span></h2>
            <div class="form-group">
                <label for="api-endpoint" data-lang-key="ui.apiEndpoint">API 端點</label>
                <input type="text" id="api-endpoint" value="https://api.openai.com/v1/chat/completions">
            </div>
            <div class="form-group">
                <label for="api-key" data-lang-key="ui.apiKey">API 金鑰</label>
                <input type="password" id="api-key">
            </div>
            <div class="form-group">
                <label for="api-model" data-lang-key="ui.model">模型</label>
                <input type="text" id="api-model" value="gpt-3.5-turbo">
            </div>
            <div class="form-group">
                <label for="theme-selector" data-lang-key="ui.theme">顏色主題</label>
                <select id="theme-selector">
                    <option value="dark">深色主題</option>
                    <option value="light">淺色主題</option>
                    <option value="cyberpunk">賽博龐克</option>
                    <option value="fantasy">奇幻</option>
                    <option value="steampunk">蒸汽龐克</option>
                    <option value="neon">霓虹</option>
                    <option value="nature">自然</option>
                    <option value="ocean">海洋</option>
                    <option value="sunset">夕陽</option>
                    <option value="galaxy">銀河</option>
                </select>
            </div>
            <div class="form-group">
                <label for="language-selector" data-lang-key="ui.language">語言</label>
                <select id="language-selector">
                    <option value="zh-TW">繁體中文</option>
                    <option value="en-US">English</option>
                </select>
            </div>
            <div class="panel-actions">
                <button id="save-settings-btn" class="btn-primary"><i class="fas fa-save"></i> <span data-lang-key="ui.saveSettings">儲存設定</span></button>
                <button id="close-settings-btn" class="btn-secondary"><i class="fas fa-times"></i> <span data-lang-key="ui.close">關閉</span></button>
            </div>
        </div>

        <!-- 角色創建介面 -->
        <div id="character-creation-panel" class="panel modal-panel active">
            <h2><i class="fas fa-user-plus"></i> <span data-lang-key="ui.characterCreation">創建你的角色</span></h2>
            <div class="form-group">
                <label for="world-type" data-lang-key="ui.selectWorld">選擇世界觀</label>
                <select id="world-type"></select>
            </div>
            <div class="form-group">
                <label for="character-description" data-lang-key="ui.characterDescription">角色描述</label>
                <textarea id="character-description" rows="5" data-lang-key="ui.characterDescriptionPlaceholder" placeholder="例如：一個勇敢的騎士，夢想是屠龍。"></textarea>
            </div>
            
            <!-- 屬性分配區域 -->
            <div class="form-group">
                <label><span data-lang-key="ui.attributeAllocation">屬性分配</span> <span id="remaining-points">(<span data-lang-key="ui.remainingPoints">剩餘點數</span>: 175)</span></label>
                <div class="cheat-mode-container">
                    <label class="checkbox-container">
                        <input type="checkbox" id="cheat-mode-checkbox">
                        <span class="checkmark"></span>
                        <span class="cheat-label" data-lang-key="ui.cheatMode">🎯 作弊模式 (無限屬性點)</span>
                    </label>
                </div>
                <div id="attribute-sliders"></div>
                <button id="reset-attributes-btn" class="btn-secondary"><i class="fas fa-undo"></i> <span data-lang-key="ui.resetAttributes">重置屬性</span></button>
            </div>
            
            <div class="panel-actions">
                <button id="start-game-btn" class="btn-primary"><i class="fas fa-play"></i> <span data-lang-key="ui.startAdventure">開始新冒險</span></button>
            </div>
        </div>

        <!-- 主遊戲介面 -->
        <div id="main-game-panel" class="panel hidden">
            <div id="narrative-container">
                <div id="narrative"></div>
                <div id="loading-indicator" class="hidden"><i class="fas fa-spinner fa-spin"></i> <span data-lang-key="ui.generating">正在生成故事...</span></div>
            </div>
            <div id="status-panel">
                <h3><i class="fas fa-heartbeat"></i> <span data-lang-key="ui.characterStatus">角色狀態</span></h3>
                <div id="status-bars"></div>
                <h3><i class="fas fa-briefcase"></i> <span data-lang-key="ui.itemsEquipment">物品 & 裝備</span></h3>
                <div id="inventory"></div>
                 <h3><i class="fas fa-star"></i> <span data-lang-key="ui.skillsAttributes">技能 & 屬性</span></h3>
                <div id="skills"></div>
            </div>
            <div id="actions-panel">
                <div id="action-buttons"></div>
                <div class="regenerate-container">
                    <button id="regenerate-btn" class="btn-secondary" title="重新生成上一個回答">
                        <i class="fas fa-redo"></i> <span data-lang-key="ui.regenerateAnswer">重新生成回答</span>
                    </button>
                </div>
                <div class="custom-action-container">
                    <input type="text" id="custom-action-input" data-lang-key="ui.customActionPlaceholder" placeholder="輸入自訂行動...">
                    <button id="custom-action-btn" class="btn-primary"><i class="fas fa-paper-plane"></i> <span data-lang-key="ui.submit">送出</span></button>
                </div>
            </div>
        </div>

        <!-- 浮動按鈕 -->
        <div id="floating-buttons">
            <button id="open-help-btn" data-lang-key="ui.help" title="使用說明"><i class="fas fa-question"></i></button>
            <button id="open-settings-btn" data-lang-key="ui.settings" title="設定"><i class="fas fa-cog"></i></button>
            <div class="save-load-dropdown">
                <button id="save-dropdown-btn" data-lang-key="ui.saveGame" title="儲存遊戲"><i class="fas fa-save"></i></button>
                <div class="dropdown-menu">
                    <button id="save-to-browser-btn" title="儲存至瀏覽器"><i class="fas fa-database"></i></button>
                    <button id="save-to-file-btn" title="下載存檔檔案"><i class="fas fa-download"></i></button>
                </div>
            </div>
            <div class="save-load-dropdown">
                <button id="load-dropdown-btn" data-lang-key="ui.loadGame" title="載入遊戲"><i class="fas fa-folder-open"></i></button>
                <div class="dropdown-menu">
                    <button id="load-from-browser-btn" title="從瀏覽器載入"><i class="fas fa-database"></i></button>
                    <button id="load-from-file-btn" title="載入存檔檔案"><i class="fas fa-upload"></i></button>
                </div>
            </div>
        </div>
    </div>

    <script src="data/worlds.js"></script>
    <script src="data/languages.js"></script>
    <script src="js/api.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/game.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
